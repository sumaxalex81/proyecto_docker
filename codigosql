-- Crear la base de datos y seleccionarla
CREATE DATABASE IF NOT EXISTS foro DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE foro;

-- Estructura de tabla para la tabla `comentarios`
CREATE TABLE `comentarios` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `publicacion_id` int(11) NOT NULL,
  `usuario` varchar(50) NOT NULL,
  `contenido` text NOT NULL,
  `comentario_padre` int(11) DEFAULT NULL,
  `imagen` varchar(255) DEFAULT NULL,
  `video` varchar(255) DEFAULT NULL,
  `fecha` datetime DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `publicacion_id` (`publicacion_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Estructura de tabla para la tabla `dato`
CREATE TABLE `dato` (
  `usuarioID` int(11) NOT NULL AUTO_INCREMENT,
  `usuario` varchar(50) DEFAULT NULL,
  `contrasenya` varchar(255) DEFAULT NULL,
  `email` varchar(50) DEFAULT NULL,
  `sexo` varchar(10) DEFAULT NULL,
  `servicios` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`servicios`)),
  `foto_perfil` varchar(255) DEFAULT NULL,
  `token_login` varchar(255) DEFAULT NULL,
  `tokenTemporal` datetime DEFAULT NULL,
  `token` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`usuarioID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Estructura de tabla para la tabla `notificaciones`
CREATE TABLE `notificaciones` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `usuario_destino` varchar(100) NOT NULL,
  `usuario_origen` varchar(100) NOT NULL,
  `publicacion_id` int(11) NOT NULL,
  `tipo` varchar(20) NOT NULL,
  `leido` tinyint(1) DEFAULT 0,
  `fecha` datetime DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `usuario_destino` (`usuario_destino`),
  KEY `publicacion_id` (`publicacion_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Estructura de tabla para la tabla `publicaciones`
CREATE TABLE `publicaciones` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `usuario` varchar(255) NOT NULL,
  `contenido` text NOT NULL,
  `fecha` datetime DEFAULT current_timestamp(),
  `imagen` varchar(255) DEFAULT NULL,
  `categoria` varchar(50) NOT NULL DEFAULT 'General',
  `video` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Estructura de tabla para la tabla `votos`
CREATE TABLE `votos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `usuario` varchar(50) NOT NULL,
  `publicacion_id` int(11) NOT NULL,
  `tipo` enum('up','down') NOT NULL,
  PRIMARY KEY (`id`),
  KEY `publicacion_id` (`publicacion_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Restricciones (Foreign Keys)
ALTER TABLE `comentarios`
  ADD CONSTRAINT `comentarios_ibfk_1` FOREIGN KEY (`publicacion_id`) REFERENCES `publicaciones` (`id`) ON DELETE CASCADE;

ALTER TABLE `votos`
  ADD CONSTRAINT `votos_ibfk_1` FOREIGN KEY (`publicacion_id`) REFERENCES `publicaciones` (`id`) ON DELETE CASCADE;

-- Insertar datos de ejemplo (basado en tu PDF)
INSERT INTO `dato` (`usuario`, `contrasenya`, `email`) VALUES 
('Admin', '$2y$10$S12SzvQeiM532H9jkkfkMwUw/elR9d64n8uyGQvJFkv@p2.FP4KBM', 'admin@gmail.com'),
('Prueba1234', '1234', 'prueba@gmail.com');

INSERT INTO `publicaciones` (`usuario`, `contenido`, `categoria`) VALUES 
('Admin', 'Bienvenido al foro', 'General');
